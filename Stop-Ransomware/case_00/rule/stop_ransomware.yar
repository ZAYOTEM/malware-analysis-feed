import "hash"

rule stop_ransomware1
{
  meta:
    description = "STOP Ransomware YARA Rule"
    author = "Emirhan Keskin"
    file_name = "f66640f4.exe"
    date = "10/04/2023"
    md5 = "5EF6D0054454A4B73ABC91F68CD7B2E3"
  strings:
    $a_pdb = "encrypt_win_api.pdb"
    $s1 = "%s %d %f"
    $s2 = "Faxowepoheroz jegagajizenu"
    $s3 = "Gotarirodeku wizowudevugex fuc wacamixutecos yifutewuviw"
    $s4 = "Nigizuzuja jaguwit sibedacuducato pox juyocokohokuk"
  condition:
    uint16(0) == 0x5A4D
    and filesize <= 1MB
    and (any of ($s*) or any of ($a*))
}

rule stop_ransomware2
{
  meta:
    description = "STOP Ransomware YARA Rule"
    author = "Emirhan Keskin"
    file_name = "Stage2.exe"
    date = "10/04/2023"
    md5 = "732b847e55e6be955d66333d9081343b"
  strings:
    $s1 = "hDwO"
    $s2 = "SUVWhlbO"
    $a_arg1 = "--Admin" wide
    $a_arg2 = "--AutoStart" wide
    $a_arg3 = "IsAutoStart" wide
    $a_arg4 = "IsNotAutoStart" wide
    $a_arg5 = "IsTask" wide
    $a_arg6 = "--ForNetRes" wide
    $a_arg7 = "--Service" wide
    $a_country_check = "country_code\":"
    $a_jpg = "5d2860c89d774.jpg" wide
    $a_scheduled_task = "Time Trigger Task" wide
    $a_user_agent = "Microsoft Internet Explorer" wide
    $a_pdb = "encrypt_win_api.pdb"
    $a_deny_perm = "/deny *S-1-1-0:(OI)(CI)(DE,DC)" wide
    $a_url ="https://api.2ip.ua/geo.json"
    $a_regkey = "Software\\Microsoft\\Windows\\CurrentVersion\\Run"
    $mutex1 = "{1D6FC66E-D1F3-422C-8A53-C0BBCF3D900D}"
    $mutex2 = "{FBB4BCC6-05C7-4ADD-B67B-A98A697323C1}"
    $mutex3 = "{36A698B9-D67C-4E07-BE82-0EC5B14B4DF5}"
  condition:
    uint16(0) == 0x5A4D
    and filesize <= 1MB
    and (any of ($s*)
    and all of ($a*)
    and 1 of ($mutex*))
}
